deploy match the snapshot:
  1: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        app: RELEASE-NAME
      name: RELEASE-NAME
      namespace: NAMESPACE
    spec:
      revisionHistoryLimit: 3
      selector:
        matchLabels:
          app: RELEASE-NAME
      strategy:
        rollingUpdate:
          maxSurge: 5
          maxUnavailable: 0
        type: null
      template:
        metadata:
          annotations:
            traffic.sidecar.istio.io/excludeInboundPorts: "2112"
            traffic.sidecar.istio.io/excludeOutboundPorts: "5432"
          labels:
            app: RELEASE-NAME
        spec:
          containers:
            - args:
                - serve
              env:
                - name: LOG_LEVEL
                  value: info
                - name: REGION
                  value: test-region
                - name: ENVIRONMENT
                  value: test-environment
                - name: IMAGE_TAG
                  value: "12345"
                - name: IMAGE_NAME
                  value: ghcr.io/openmfp/iam-service
                - name: DATABASE_INMEMORY
                  value: "false"
                - name: DATABASE_PASSWORD
                  valueFrom:
                    secretKeyRef:
                      key: password
                      name: RELEASE-NAME-postgresql
                - name: DATABASE_DSN
                  value: postgresql://iam-service:$(DATABASE_PASSWORD)@RELEASE-NAME-postgresql:5432/iam-service?sslmode=disable
              image: ghcr.io/openmfp/iam-service:12345
              imagePullPolicy: IfNotPresent
              name: RELEASE-NAME
              ports:
                - containerPort: 8081
                  name: grpc
                  protocol: TCP
          imagePullSecrets:
            - name: github
          initContainers:
            - command:
                - sh
                - -c
                - |
                  echo "Checking PostgreSQL connection..."
                  until nc -z -v -w30 RELEASE-NAME-postgresql 5432
                  do
                    echo "Waiting for PostgreSQL connection..." && sleep 5
                  done
                  echo "PostgreSQL is up and running."
              image: busybox
              name: check-postgres-connection
          serviceAccountName: RELEASE-NAME
deploy match the snapshot with openfga:
  1: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        app: RELEASE-NAME
      name: RELEASE-NAME
      namespace: NAMESPACE
    spec:
      revisionHistoryLimit: 3
      selector:
        matchLabels:
          app: RELEASE-NAME
      strategy:
        rollingUpdate:
          maxSurge: 5
          maxUnavailable: 0
        type: null
      template:
        metadata:
          annotations:
            traffic.sidecar.istio.io/excludeInboundPorts: "2112"
            traffic.sidecar.istio.io/excludeOutboundPorts: "5432"
          labels:
            app: RELEASE-NAME
        spec:
          containers:
            - args:
                - serve
              env:
                - name: LOG_LEVEL
                  value: info
                - name: REGION
                  value: test-region
                - name: ENVIRONMENT
                  value: test-environment
                - name: IMAGE_TAG
                  value: "12345"
                - name: IMAGE_NAME
                  value: ghcr.io/openmfp/iam-service
                - name: DATABASE_INMEMORY
                  value: "false"
                - name: DATABASE_PASSWORD
                  valueFrom:
                    secretKeyRef:
                      key: password
                      name: RELEASE-NAME-postgresql
                - name: DATABASE_DSN
                  value: postgresql://iam-service:$(DATABASE_PASSWORD)@RELEASE-NAME-postgresql:5432/iam-service?sslmode=disable
              image: ghcr.io/openmfp/iam-service:12345
              imagePullPolicy: IfNotPresent
              name: RELEASE-NAME
              ports:
                - containerPort: 8081
                  name: grpc
                  protocol: TCP
          imagePullSecrets:
            - name: github
          initContainers:
            - command:
                - sh
                - -c
                - |
                  echo "Checking PostgreSQL connection..."
                  until nc -z -v -w30 RELEASE-NAME-postgresql 5432
                  do
                    echo "Waiting for PostgreSQL connection..." && sleep 5
                  done
                  echo "PostgreSQL is up and running."
              image: busybox
              name: check-postgres-connection
          serviceAccountName: RELEASE-NAME
